#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Docker –æ–±—Ä–∞–∑–∞
# –ê–≤—Ç–æ—Ä: dushes

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "===== –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –¥–µ–ø–ª–æ—é ====="

# –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
echo "üîë –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ Docker Hub (docker login)"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ buildx –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏
echo "===== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker Buildx ====="
docker buildx use cloud-dushes-builder

# –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä—Å–∏—é –∏–∑ git —Ç–µ–≥–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∫–∞–∫ –≤–µ—Ä—Å–∏—é
VERSION=$(date +"%Y.%m.%d-%H.%M")
echo "===== –ù–∞—á–∏–Ω–∞–µ–º –º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—É—é —Å–±–æ—Ä–∫—É –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—é ====="
echo "–í–µ—Ä—Å–∏—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: $VERSION"

docker buildx build --platform linux/amd64,linux/arm64 \
  -t dushes/telegram-client:latest \
  -t dushes/telegram-client:$VERSION \
  --push .


echo "‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!" 